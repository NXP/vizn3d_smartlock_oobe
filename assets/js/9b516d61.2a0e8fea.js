"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[385],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},v=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),v=c(n),u=i,m=v["".concat(l,".").concat(u)]||v[u]||d[u]||r;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=v;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}v.displayName="MDXCreateElement"},2367:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return v}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],s={sidebar_position:1},l="Overview",c={unversionedId:"framework/events/overview",id:"framework/events/overview",isDocsHomePage:!1,title:"Overview",description:"Events are a means by which information is communicated between different devices via their managers.",source:"@site/docs/framework/events/overview.md",sourceDirName:"framework/events",slug:"/framework/events/overview",permalink:"/vizn3d_smartlock_oobe/docs/framework/events/overview",editUrl:"https://github.com/nxp/vizn3d_smartlock_oobe/docs/docs/docs/framework/events/overview.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Low Power Devices",permalink:"/vizn3d_smartlock_oobe/docs/framework/hal-devices/low-power"},next:{title:"Event Handlers",permalink:"/vizn3d_smartlock_oobe/docs/framework/events/event-handlers"}},p=[{value:"Event Triggers",id:"event-triggers",children:[],level:2},{value:"Types of Events",id:"types-of-events",children:[{value:"InferComplete Events",id:"infercomplete-events",children:[],level:3},{value:"InputNotify Events",id:"inputnotify-events",children:[],level:3}],level:2}],d={toc:p};function v(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Events are a means by which information is communicated between different devices via their managers."),(0,r.kt)("h2",{id:"event-triggers"},"Event Triggers"),(0,r.kt)("p",null,"Events can correspond to many different happenings during the runtime of the application,\nand can include things like:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Button pressed"),(0,r.kt)("li",{parentName:"ul"},"Face detected"),(0,r.kt)("li",{parentName:"ul"},"Shell command received")),(0,r.kt)("p",null,"When an event is triggered, the device which first received the event will communicate that event to its manager,\nwhich in turn will notify other managers designated to receive the event."),(0,r.kt)("p",null,"For example,\nwhen a button is pressed,\na flow similar to the following will take place:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'The "Push Button" HAL device will receive an interrupt corresponding to the button that was pressed.'),(0,r.kt)("li",{parentName:"ol"},"Inside the HAL device's interrupt handler,\nthe device will associate an event with the button that was pressed."),(0,r.kt)("li",{parentName:"ol"},"The HAL device will specify which managers should receive the event."),(0,r.kt)("li",{parentName:"ol"},"The HAL device will forward the event to its manager.")),(0,r.kt)("p",null,"The code which corresponds to this scenario can be seen in the below excerpts from ",(0,r.kt)("inlineCode",{parentName:"p"},"HAL/common/hal_input_push_buttons.c"),'" and ',(0,r.kt)("inlineCode",{parentName:"p"},"source/event_handlers/smart_lock_input_push_buttons.c"),", respectively."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:'title="HAL/common/hal_input_push_buttons.c" {10,11}',title:'"HAL/common/hal_input_push_buttons.c"',"{10,11}":!0},'void _HAL_InputDev_IrqHandler(button_data_t *button, switch_press_type_t pressType)\n{\n    if (s_InputDev_PushButtons.cap.callback != NULL)\n    {\n        uint32_t receiverList;\n        if (APP_InputDev_PushButtons_SetEvent(button->buttonId, pressType, &s_pEvent, &receiverList) == kStatus_Success)\n        {\n            s_inputEvent.inputData = s_pEvent;\n            uint8_t fromISR        = __get_IPSR();\n            s_InputDev_PushButtons.cap.callback(&s_InputDev_PushButtons, kInputEventID_Recv, receiverList,\n                                                &s_inputEvent, 0, fromISR);\n        }\n        else\n        {\n            LOGE("No valid event associated with SW%d button %s press", button->buttonId,\n                 pressType == kSwitchPressType_Short ? "short" : "long");\n        }\n    }\n}\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},'The "callback" function in the above code refers to an internal callback function inside the ',(0,r.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/device-managers/input_manager"},"Input Manager"),"\nwhich relays input events to each of the managers specified in an event's ",(0,r.kt)("inlineCode",{parentName:"p"},"receiverList"),"."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'    switch (button)\n    {\n        case kSwitchID_1:\n            if (pressType == kSwitchPressType_Long)\n            {\n                LOGD("Long PRESS Detected.");\n                unsigned int totalUsageCount;\n                FWK_LpmManager_RequestStatus(&totalUsageCount);\n                FWK_LpmManager_EnableSleepMode(kLPMManagerStatus_SleepEnable);\n            }\n            break;\n\n        case kSwitchID_2:\n            if ((pressType == kSwitchPressType_Short) || (pressType == kSwitchPressType_Long))\n            {\n                *receiverList                    = 1 << kFWKTaskID_VisionAlgo;\n                s_FaceRecEvent.eventBase.eventId = kEventFaceRecID_DelUser;\n                s_FaceRecEvent.delFace.hasName   = false;\n                s_FaceRecEvent.delFace.hasID     = false;\n                *event                           = &s_FaceRecEvent;\n            }\n            break;\n\n        case kSwitchID_3:\n            if ((pressType == kSwitchPressType_Short) || (pressType == kSwitchPressType_Long))\n            {\n                *receiverList                    = 1 << kFWKTaskID_VisionAlgo;\n                s_FaceRecEvent.eventBase.eventId = kEventFaceRecID_AddUser;\n                s_FaceRecEvent.addFace.hasName   = false;\n                *event                           = &s_FaceRecEvent;\n            }\n            break;\n\n        default:\n            ret = kStatus_Fail;\n            break;\n    }\n\n    return ret;\n')),(0,r.kt)("h2",{id:"types-of-events"},"Types of Events"),(0,r.kt)("p",null,"Events can be used to communicate all sorts of information,\nbut the two types of events defined by default are\n",(0,r.kt)("a",{parentName:"p",href:"#infercomplete-events"},(0,r.kt)("strong",{parentName:"a"},"InferComplete"))," events and ",(0,r.kt)("a",{parentName:"p",href:"#inputnotify-events"},(0,r.kt)("strong",{parentName:"a"},"InputNotify"))," events."),(0,r.kt)("p",null,"Both types of events represent different information being communicated to and by the HAL devices."),(0,r.kt)("h3",{id:"infercomplete-events"},"InferComplete Events"),(0,r.kt)("p",null,"Inference events are used to indicate that a vision/voice algorithm HAL device has completed a stage in its inference pipeline."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Currently, only output HAL devices can respond to ",(0,r.kt)("inlineCode",{parentName:"p"},"InferComplete")," events.\nThis is not true of ",(0,r.kt)("inlineCode",{parentName:"p"},"InputNotify")," events."))),(0,r.kt)("p",null,"In the Smart Lock application, this can refer to several things, including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Face detected"),(0,r.kt)("li",{parentName:"ul"},"Face recognized"),(0,r.kt)("li",{parentName:"ul"},"Fake face detected")),(0,r.kt)("p",null,"Output HAL devices can respond to inference events by implementing an ",(0,r.kt)("inlineCode",{parentName:"p"},"inferComplete"),' method.\nWhen an "InferComplete" event is triggered,\nthe output manager attempts to call the ',(0,r.kt)("inlineCode",{parentName:"p"},"inferComplete")," event handler of each of its devices,\n(assuming the device has implemented an ",(0,r.kt)("inlineCode",{parentName:"p"},"inferComplete")," function)."),(0,r.kt)("p",null,"As part of the ",(0,r.kt)("inlineCode",{parentName:"p"},"inferComplete")," function call,\nthe output manager will also communicate the HAL device from which the event originated, the ID of the event received,\nas well as any additional information related to the event that was generated."),(0,r.kt)("p",null,'For example, a "Face Recognized" event will also include the ID of the face being recognized. Below is an example of how the RGB LED HAL device responds to several different events.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:'title="RGB Output Device InferComplete Handler" {12,15}',title:'"RGB',Output:!0,Device:!0,InferComplete:!0,'Handler"':!0,"{12,15}":!0},"static hal_output_status_t HAL_OutputDev_RgbLed_InferComplete(const output_dev_t *dev,\n                                                              output_algo_source_t source,\n                                                              void *inferResult)\n{\n    vision_algo_result_t *visionAlgoResult = (vision_algo_result_t *)inferResult;\n    hal_output_status_t error              = kStatus_HAL_OutputSuccess;\n\n    if (visionAlgoResult != NULL)\n    {\n        if (visionAlgoResult->id == kVisionAlgoID_OasisLite)\n        {\n            oasis_lite_result_t *result = &(visionAlgoResult->oasisLite);\n            if (source == kOutputAlgoSource_Vision)\n            {\n                if ((result->face_recognized) && (result->face_id >= 0))\n                {\n                    RGB_LED_SET_COLOR(kRGBLedColor_Green);\n                }\n                else if (result->face_count)\n                {\n                    RGB_LED_SET_COLOR(kRGBLedColor_Red);\n                }\n                else\n                {\n                    RGB_LED_SET_COLOR(kRGBLedColor_Off);\n                }\n            }\n        }\n")),(0,r.kt)("p",null,"For more information about handling events, see ",(0,r.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/events/event-handlers"},"event handlers"),"."),(0,r.kt)("h3",{id:"inputnotify-events"},"InputNotify Events"),(0,r.kt)("p",null,"Input events are events which indicate that input has been received by an input HAL device."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},'Only input HAL devices can generate an "InputNotify" event.\nHowever, all HAL devices\n(with the exception of ',(0,r.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/hal-devices/low-power"},"LPM"),', Flash, and Graphics devices)\nare able to respond to an "InputNotify" event.'))),(0,r.kt)("p",null,"Examples of input events include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Button pressed"),(0,r.kt)("li",{parentName:"ul"},"Shell command received"),(0,r.kt)("li",{parentName:"ul"},"Wi-Fi/BLE input received")),(0,r.kt)("p",null,"The event to generate for a given input is decided by the device which receives the input."),(0,r.kt)("p",null,"For example, the Push Button device associates different events based on the different button presses and the duration of those button presses, either long or short presses."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c",metastring:'title="Push Button Event Generator"',title:'"Push',Button:!0,Event:!0,'Generator"':!0},'    switch (button)\n    {\n        case kSwitchID_1:\n            if (pressType == kSwitchPressType_Long)\n            {\n                LOGD("Long PRESS Detected.");\n                unsigned int totalUsageCount;\n                FWK_LpmManager_RequestStatus(&totalUsageCount);\n                FWK_LpmManager_EnableSleepMode(kLPMManagerStatus_SleepEnable);\n            }\n            break;\n\n        case kSwitchID_2:\n            if ((pressType == kSwitchPressType_Short) || (pressType == kSwitchPressType_Long))\n            {\n                *receiverList                    = 1 << kFWKTaskID_VisionAlgo;\n                s_FaceRecEvent.eventBase.eventId = kEventFaceRecID_DelUser;\n                s_FaceRecEvent.delFace.hasName   = false;\n                s_FaceRecEvent.delFace.hasID     = false;\n                *event                           = &s_FaceRecEvent;\n            }\n            break;\n\n        case kSwitchID_3:\n            if ((pressType == kSwitchPressType_Short) || (pressType == kSwitchPressType_Long))\n            {\n                *receiverList                    = 1 << kFWKTaskID_VisionAlgo;\n                s_FaceRecEvent.eventBase.eventId = kEventFaceRecID_AddUser;\n                s_FaceRecEvent.addFace.hasName   = false;\n                *event                           = &s_FaceRecEvent;\n            }\n            break;\n\n        default:\n            ret = kStatus_Fail;\n            break;\n    }\n')),(0,r.kt)("p",null,"Alongside an input event,\nthe HAL device from which the event originated may also relay additional information as well.\nDepending on the event, this may correspond to the button that was pressed, the shell command and args that were received, etc."),(0,r.kt)("p",null,"In the above example,\nwe can see that pressing the SW3 push button generates a ",(0,r.kt)("inlineCode",{parentName:"p"},"kEventFaceRecID_AddUser")," event, specifying that there is no name for the face to add."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"A list of general events can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"hal_event_descriptor_common.h"),", while a list of face recognition-specific events can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"hal_event_descriptor_face_rec.h"),".\nIt is recommended that new events be added to the ",(0,r.kt)("inlineCode",{parentName:"p"},"hal_event_descriptor_common.h")," file."))),(0,r.kt)("p",null,'To respond to an "InputNotify" event, a HAL device must implement an ',(0,r.kt)("inlineCode",{parentName:"p"},"inputNotify"),' handler function.\nWhen an "InputNotify" event is triggered,\neach manager which receives the event attempts to call the ',(0,r.kt)("inlineCode",{parentName:"p"},"inputNotify")," method of every one of its devices,\n(assuming the device has implemented an ",(0,r.kt)("inlineCode",{parentName:"p"},"inputNotify")," method)."),(0,r.kt)("p",null,"For more information regarding event handlers, see ",(0,r.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/events/event-handlers"},"event handlers"),"."))}v.isMDXComponent=!0}}]);