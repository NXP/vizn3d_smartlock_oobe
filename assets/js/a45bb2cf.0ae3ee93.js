"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[791],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(n),u=i,h=m["".concat(c,".").concat(u)]||m[u]||d[u]||o;return n?a.createElement(h,r(r({ref:t},p),{},{components:n})):a.createElement(h,r({ref:t},p))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5747:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],s={sidebar_position:2,title:"HAL WiFi"},c="HAL WiFi Introduction",l={unversionedId:"smart_lock/hal_wifi",id:"smart_lock/hal_wifi",isDocsHomePage:!1,title:"HAL WiFi",description:"The SLN-VIZN3D-IOT board is equipped with an Azurewave Technologies AW-AM510 WiFi Module, which supports 802.11a/b/g/n on the 2.4GHz and 5GHz bands,",source:"@site/docs/smart_lock/hal_wifi.md",sourceDirName:"smart_lock",slug:"/smart_lock/hal_wifi",permalink:"/vizn3d_smartlock_oobe/docs/smart_lock/hal_wifi",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"HAL WiFi"},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/vizn3d_smartlock_oobe/docs/smart_lock/intro"}},p=[{value:"Integrating the WiFi module",id:"integrating-the-wifi-module",children:[{value:"WiFi Task",id:"wifi-task",children:[],level:3},{value:"FTP Client",id:"ftp-client",children:[],level:3}],level:2}],d={toc:p};function m(e){var t=e.components,s=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"hal-wifi-introduction"},"HAL WiFi Introduction"),(0,o.kt)("p",null,"The SLN-VIZN3D-IOT board is equipped with an ",(0,o.kt)("strong",{parentName:"p"},"Azurewave Technologies AW-AM510 WiFi Module"),", which supports 802.11a/b/g/n on the 2.4GHz and 5GHz bands,\nas well as supporting Bluetooth 5.1."),(0,o.kt)("p",null,"For the time being,\nthe requirements for the WiFi cover:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Module hardware initialization"),(0,o.kt)("li",{parentName:"ul"},"Local access point connection"),(0,o.kt)("li",{parentName:"ul"},"Connect to a non-secure FTP server with anonymous credentials")),(0,o.kt)("h2",{id:"integrating-the-wifi-module"},"Integrating the WiFi module"),(0,o.kt)("p",null,"The WiFi module is a special type of peripheral which acts as both an input and an output.\nDespite this fact,\nintegrating the WiFi module with the framework can be done by registering both an ",(0,o.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/hal_devices/input"},"input device"),",\nand an ",(0,o.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/hal_devices/output"},"output device"),"."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Because the module is registered to two managers at the same time,\nsome degree of synchronization needs to be implemented to avoid various race conditions."))),(0,o.kt)("h3",{id:"wifi-task"},"WiFi Task"),(0,o.kt)("p",null,"The WiFi initialization task will automatically create several other tasks\nto handle TCP Connections,\nmodule communication,\nand the WiFi dispatcher.\nHowever, because WiFi operations are slow compared to the speed at which the CPU operates,\nthe calling task will block waiting for an answer.",(0,o.kt)("sup",{parentName:"p",id:"fnref-1"},(0,o.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("sup",{parentName:"p",id:"fnref-1"},(0,o.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," To alleviate this issue, the NXP driver supports asynchronous operation,\nhowever the code complexity will grow and the need for synchronization will increase."))),(0,o.kt)("p",null,"In order to avoid blocking important resources like the ",(0,o.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/device_managers/output_manager"},"Output Manager")," task or the ",(0,o.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/device_managers/input_manager"},"Input Manager")," task,\nthe WiFi device must maintain a standalone execution task in which waiting operations can be performed with minimal impact to the rest of the system."),(0,o.kt)("p",null,"The communication between the WiFi, Input Manager, and Output Manager tasks uses an event-driven design\nwhich can help to decrease the number of potential errors caused by race conditions."),(0,o.kt)("p",null,"The following diagram presents the components involved."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"WiFi Communication Diagram",src:n(5212).Z})),(0,o.kt)("p",null,"The function logic in order to connect to an access point is as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"BOARD_InitWIFIAW_AM510Resource()")," - Initialize hardware pins"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"WPL_Init()")," - Load the WiFi firmware on the AW-AM510 chip"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"WiFi_GetCredentials (&credentials)")," - Get the saved credentials"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"WPL_Join (credentials)")," - Join the network specified by the credentials.")),(0,o.kt)("h3",{id:"ftp-client"},"FTP Client"),(0,o.kt)("p",null,"The Smart Lock application is capable of maintaining brief videos which have been captured by the camera.\nThis feature can be useful in applications where a user wants to review important activity captured by the camera."),(0,o.kt)("p",null,"After encoding a captured image frame,\nthe Output Manager will send a message to the WiFi Task via the ",(0,o.kt)("inlineCode",{parentName:"p"},"InferenceComplete")," callback\nwhich contains a pointer to the location and the size of the video.\nAfter that,\nthe WiFi task will kick off the procedure to establish a connection with an FTP server."),(0,o.kt)("p",null,"Connecting to an FTP server uses a handshake procedure similar to the process of connecting to an access point.\nThe steps are as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"FTP_Init")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"FTP_ConnectBlocking")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"FTP_StoreBlocking")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"FTP_DisconnectBlocking"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"FTP_Init();\nftp_session_handle_t handle = FTP_ConnectBlocking();\nif (handle != NULL)\n{\n    FTP_StoreBlocking(handle, remote_path, recordedDataAddress, recordedDataSize);\n    FTP_DisconnectBlocking(handle);\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Fetches the Server Info from the flash, init internal structures.\n *\n * @return kStatus_Success on success\n */\nstatus_t FTP_Init(void);\n\n/**\n * @brief Connect to the server specified by saved server_info\n *\n * @return Return a handler which is to be used with the store/disconnect function. NULL if no connection was done\n */\n\nftp_session_handle_t FTP_ConnectBlocking(void);\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For now only anonymous unsecured FTP connections are supported.\nIn order to supply credentials for the FTP server,\nmodify the ",(0,o.kt)("inlineCode",{parentName:"p"},"FTP_ConnectBlocking")," function in ",(0,o.kt)("inlineCode",{parentName:"p"},"ftp_client.c"),"."),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-c"},'        ftpSession.user = "anonymous" /* set manually the user */;\n        ftpSession.pass = "anonymous@domain.com" /* set manually the password */;\n')),(0,o.kt)("p",{parentName:"div"},"After changing the code,\nrebuild and reflash the application."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Store the data at a specific remote location.\n *\n * @param sessionHandler Session handler obtain after the connect operation took place\n * @param remote_path Remote path at which to save the file. Should contain the name of the file\n * @param data_source   Data to be saved\n * @param len   Length of the file\n * @return kStatus_Success on success. If the status was fail, automatic disconnection takes place\n */\nstatus_t FTP_StoreBlocking(ftp_session_handle_t sessionHandler, const char *remotePath, char *dataSource, uint32_t len);\n\n/**\n * @brief Disconnect from a connected server\n *\n * @param sessionHandler\n * @return kStatus_Success on success\n */\nstatus_t FTP_DisconnectBlocking(ftp_session_handle_t sessionHandler);\n\n")))}m.isMDXComponent=!0},5212:function(e,t,n){t.Z=n.p+"assets/images/hal_wifi-0ff4cf06f544410ebf7893d682461598.jpg"}}]);