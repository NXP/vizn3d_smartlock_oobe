"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[271],{3905:function(e,a,t){t.d(a,{Zo:function(){return h},kt:function(){return m}});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=n.createContext({}),c=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},h=function(e){var a=c(e.components);return n.createElement(o.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),p=c(t),m=r,f=p["".concat(o,".").concat(m)]||p[m]||d[m]||i;return t?n.createElement(f,s(s({ref:a},h),{},{components:t})):n.createElement(f,s({ref:a},h))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=t.length,s=new Array(i);s[0]=p;var l={};for(var o in a)hasOwnProperty.call(a,o)&&(l[o]=a[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<i;c++)s[c]=t[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},3436:function(e,a,t){t.r(a),t.d(a,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return c},toc:function(){return h},default:function(){return p}});var n=t(7462),r=t(3366),i=(t(7294),t(3905)),s=["components"],l={sidebar_position:10},o="Flash Manager",c={unversionedId:"framework/device_managers/flash_manager",id:"framework/device_managers/flash_manager",isDocsHomePage:!1,title:"Flash Manager",description:"The Flash Manager is used to provide an abstraction for an underlying filesystem implementation.",source:"@site/docs/framework/device_managers/flash_manager.md",sourceDirName:"framework/device_managers",slug:"/framework/device_managers/flash_manager",permalink:"/vizn3d_smartlock_oobe/docs/framework/device_managers/flash_manager",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Audio Processing Manager",permalink:"/vizn3d_smartlock_oobe/docs/framework/device_managers/audio_processing"},next:{title:"Overview",permalink:"/vizn3d_smartlock_oobe/docs/framework/hal_devices/overview"}},h=[{value:"Device APIs",id:"device-apis",children:[{value:"FWK_Flash_DeviceRegister",id:"fwk_flash_deviceregister",children:[],level:3},{value:"FWK_Flash_Init",id:"fwk_flash_init",children:[],level:3},{value:"FWK_Flash_Deinit",id:"fwk_flash_deinit",children:[],level:3}],level:2},{value:"Operations APIs",id:"operations-apis",children:[{value:"FWK_Flash_Format",id:"fwk_flash_format",children:[],level:3},{value:"FWK_Flash_Save",id:"fwk_flash_save",children:[],level:3},{value:"FWK_Flash_Append",id:"fwk_flash_append",children:[],level:3},{value:"FWK_Flash_Read",id:"fwk_flash_read",children:[],level:3},{value:"FWK_Flash_Mkdir",id:"fwk_flash_mkdir",children:[],level:3},{value:"FWK_Flash_Rm",id:"fwk_flash_rm",children:[],level:3},{value:"FWK_Flash_Rename",id:"fwk_flash_rename",children:[],level:3},{value:"FWK_Flash_Cleanup",id:"fwk_flash_cleanup",children:[],level:3}],level:2}],d={toc:h};function p(e){var a=e.components,t=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"flash-manager"},"Flash Manager"),(0,i.kt)("p",null,"The Flash Manager is used to provide an abstraction for an underlying filesystem implementation."),(0,i.kt)("p",null,'Due to the unique nature of the filesystem being an abstract "virtual" device,\nonly one flash device can be registered at a time.\nHowever,\ngenerally there should be no need to have more than one filesystem.\nThis means the Flash Manager\'s API functions essentially act as wrappers which calls the ',(0,i.kt)("a",{parentName:"p",href:"/vizn3d_smartlock_oobe/docs/framework/hal_devices/overview#operators"},"Operators")," of the underlying flash HAL device.",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," Flash access is exclusive, one request at a time."))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"When working with the Flash Manager,\nunlike most other managers,\n",(0,i.kt)("inlineCode",{parentName:"p"},"FWK_Flash_DeviceRegister")," should be called ",(0,i.kt)("em",{parentName:"p"},"before")," ",(0,i.kt)("inlineCode",{parentName:"p"},"FWK_Flash_Init"),"."))),(0,i.kt)("h2",{id:"device-apis"},"Device APIs"),(0,i.kt)("h3",{id:"fwk_flash_deviceregister"},"FWK_Flash_DeviceRegister"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Only one flash device is supported. Registered a flash filesystem device\n * @param dev Pointer to a flash device structure\n * @return int Return 0 if registration was successful\n */\nint FWK_Flash_DeviceRegister(const flash_dev_t *dev);\n")),(0,i.kt)("p",null,"Unlike the flow for most other managers,\nthis function should be called ",(0,i.kt)("em",{parentName:"p"},"before")," ",(0,i.kt)("inlineCode",{parentName:"p"},"FWK_Flash_Init"),"."),(0,i.kt)("h3",{id:"fwk_flash_init"},"FWK_Flash_Init"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Init internal structures for flash.\n * @return int Return 0 if the init process was successful\n */\nsln_flash_status_t FWK_Flash_Init();\n")),(0,i.kt)("h3",{id:"fwk_flash_deinit"},"FWK_Flash_Deinit"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Deinit internal structures for flash.\n * @return int Return 0 if the init process was successful\n */\nsln_flash_status_t FWK_Flash_Deinit();\n")),(0,i.kt)("h2",{id:"operations-apis"},"Operations APIs"),(0,i.kt)("p",null,"The Flash Manager and underlying flash HAL device define only a few operations in order to keep the API simple and easy to implement.\nThese API functions include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Format"),(0,i.kt)("li",{parentName:"ul"},"Save"),(0,i.kt)("li",{parentName:"ul"},"Delete"),(0,i.kt)("li",{parentName:"ul"},"Read"),(0,i.kt)("li",{parentName:"ul"},"Make Directory"),(0,i.kt)("li",{parentName:"ul"},"Append"),(0,i.kt)("li",{parentName:"ul"},"Rename"),(0,i.kt)("li",{parentName:"ul"},"Cleanup")),(0,i.kt)("p",null,"While this might limit filesystem functionality,\nit also helps to keep the code readable, portable, and maintainable."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If the default list of APIs does not satisfy the requirements of a use-case,\nthe API can always be extended or bypassed in the code directly."))),(0,i.kt)("h3",{id:"fwk_flash_format"},"FWK_Flash_Format"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Format the filesystem\n * @return the status of formatting operation\n */\nsln_flash_status_t FWK_Flash_Format();\n")),(0,i.kt)("h3",{id:"fwk_flash_save"},"FWK_Flash_Save"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Save the data into a file from the file system\n * @param path Path of the file in the file system\n * @param buf  Buffer which contains the data that is going to be saved\n * @param size Size of the buffer\n * @return the status of save operation\n */\nsln_flash_status_t FWK_Flash_Save(const char *path, void *buf, unsigned int size);\n")),(0,i.kt)("h3",{id:"fwk_flash_append"},"FWK_Flash_Append"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Append the data to an existing file.\n * @param path Path of the file in the file system\n * @param buf  Buffer which contains the data that is going to be append\n * @param size Size of the buffer\n * @param overwrite Boolean parameter. If true the existing file will be truncated. Similar to SLN_flash_save\n * @return the status of append operation\n */\n sln_flash_status_t FWK_Flash_Append(const char *path, void *buf, unsigned int size, bool overwrite);\n")),(0,i.kt)("h3",{id:"fwk_flash_read"},"FWK_Flash_Read"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"For now ",(0,i.kt)("inlineCode",{parentName:"p"},"read")," with an offset has not been implemented.\nThis is currently planned for a future release."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Read from a file\n * @param path Path of the file in the file system\n * @param buf  Buffer in which to store the read value\n * @param size Size that was read.\n * @return the status of read operation\n */\nsln_flash_status_t FWK_Flash_Read(const char *path, void *buf, unsigned int size);\n")),(0,i.kt)("h3",{id:"fwk_flash_mkdir"},"FWK_Flash_Mkdir"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Make directory operation\n * @param path Path of the directory in the file system\n * @return the status of mkdir operation\n */\nsln_flash_status_t FWK_Flash_Mkdir(const char *path);\n")),(0,i.kt)("h3",{id:"fwk_flash_rm"},"FWK_Flash_Rm"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Remove file\n * @param path Path of the file that shall be removed\n * @return the status of rm operation\n */\nsln_flash_status_t FWK_Flash_Rm(const char *path);\n")),(0,i.kt)("h3",{id:"fwk_flash_rename"},"FWK_Flash_Rename"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Rename existing file\n * @param OldPath Path of the file that is renamed\n * @param NewPath New Path of the file\n * @return status of rename operation\n */\nsln_flash_status_t FWK_Flash_Rename(const char *oldPath, const char *newPath);\n")),(0,i.kt)("h3",{id:"fwk_flash_cleanup"},"FWK_Flash_Cleanup"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/**\n * @brief Cleanup function. Might imply defragmentation, erased unused sectors etc.\n *\n * @param timeout Time consuming operation. Set a time constrain to be sure that is not disturbing the system.\n *               Timeout = 0 means no timeout\n * @return status of cleanup operation\n */\nsln_flash_status_t FWK_Flash_Cleanup(uint32_t timeout);\n")))}p.isMDXComponent=!0}}]);